generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider = "zod-prisma-types"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @default(uuid())
  snipeItUserId Int           @unique
  email         String        @unique
  name          String
  weekQuotaUsed Int
  hasOutstandingBalance Boolean @default(false) // For fee tracking
  reservations  Reservation[]
  courses       UserCourse[]
  fines         Fine[]
}

model Asset {
  id           Int           @id
  assetTag     String        @unique
  modelName    String
  category     String
  reservations Reservation[]
  courses      AssetCourse[]
}

model Reservation {
  id           String   @id @default(uuid())
  snipeAssetId Int
  userId       String
  startTime    DateTime
  endTime      DateTime
  status       String   @default("PENDING") // PENDING, CONFIRMED, CHECKED_OUT, COMPLETED, CANCELLED
  assetType    String   @default("Unknown") // For 3-block limit checking

  user  User  @relation(fields: [userId], references: [id])
  asset Asset @relation(fields: [snipeAssetId], references: [id])

  @@map("reservations")
}

model Fine {
  id        String   @id @default(uuid())
  userId    String
  reason    String   // e.g., "Late Return", "Damaged Equipment"
  amount    Float    // Fee amount in dollars
  dateIssued DateTime @default(now())
  isPaid    Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id])

  @@map("fines")
}

model BlackoutDate {
  id     String   @id @default(uuid())
  date   DateTime @unique
  reason String

  @@map("blackout_dates")
}

model Course {
  id       Int           @id @default(autoincrement())
  code     String
  semester String
  users    UserCourse[]
  assets   AssetCourse[]
}

model UserCourse {
  userId   String @map("user_id")
  courseId Int    @map("course_id")
  user     User   @relation(fields: [userId], references: [id])
  course   Course @relation(fields: [courseId], references: [id])

  @@id([userId, courseId])
}

model AssetCourse {
  assetId  Int    @map("asset_id")
  courseId Int    @map("course_id")
  asset    Asset  @relation(fields: [assetId], references: [id])
  course   Course @relation(fields: [courseId], references: [id])

  @@id([assetId, courseId])
}
